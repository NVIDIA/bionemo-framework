defaults:
  - base_config

name: prott5nv_sspred
do_training: True # set to false if data preprocessing steps must be completed
do_testing: False # set to true to run evaluation on test data after training, requires test_dataset section
restore_from_path: /model/protein/prott5nv/prott5nv.nemo # used when starting from a .nemo file

trainer:
  devices: 1
  num_nodes: 1
  accelerator: gpu
  precision: 16
  max_steps: 10 # consumed_samples = global_step * micro_batch_size * data_parallel_size * accumulate_grad_batches
  val_check_interval: 10
  limit_val_batches: 1
  accumulate_grad_batches: 1
  num_sanity_val_steps: 0

model:
  global_batch_size: null
  micro_batch_size: 4
  data:
    data_url: 'https://ftp.uniprot.org/pub/databases/uniprot/uniref/uniref50/uniref50.fasta.gz' 
    dataset_path: ${oc.env:PROJECT_MOUNT}/examples/tests/test_data/protein # parent directory for data, contains train / val / test folders
    dataset: # inclusive range of data files to load or can load a single file, e.g. x000.csv
      train: x000
      test: x000
      val: x000
    data_prefix: null
    data_col: 3 # 0-based
    data_sep: ','
    header_lines: 1
  validation:
    validation_enabled: True
    datasets:
      - name: SSPred
        class: SSPredictionCallback
        enabled: True
        infer_target: bionemo.model.protein.prott5nv.infer.ProtT5nvInference
        emb_type: "T5"
        emb_batch_size: 256
        batch_size: 256
        num_epochs: 5
        check_val_every_n_epoch: 1
        shuffle: False
        num_workers: 20
        train_ds: 
          data_file: ${oc.env:PROJECT_MOUNT}/examples/tests/test_data/protein/downstream/train/x000.csv
        test_ds: 
          data_file: ${oc.env:PROJECT_MOUNT}/examples/tests/test_data/protein/downstream/test/x000.csv
        random_seed: 1234
        optim:
            name: adam
            lr: 0.0001
            betas:
              - 0.9
              - 0.999
            eps: 1e-8
            weight_decay: 0.01
            sched:
              name: WarmupAnnealing
              min_lr: 0.00001
              last_epoch: -1
              warmup_ratio: 0.01
              max_steps: 1000
  
exp_manager:
  exp_dir: /tmp/nemo_experiments/prott5nv_sspred
  create_wandb_logger: False
  create_tensorboard_logger: False
  wandb_logger_kwargs:
    offline: True